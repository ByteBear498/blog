---
title: 树莓派3b+安装openwrt 18.06.4
date: 2019-07-27 22:36:15
tags: 
 - openwrt
categories: 
 - other
---

本文的连接方式是，将树莓派连唯一的网口作为wan口连接到上级路由lan口上，然后通过树莓派无线来访问网络。



### 刷固件

目前openwrt官方Stable Release版本是18.06.4，但是对于树莓派3b+开发版是不支持无线wifi的（unsupported functions：Country Code setting, WiFi 2.4GHz  WiFi 5GHz , WIP）[官方树莓派网页](https://openwrt.org/toh/raspberry_pi_foundation/raspberry_pi) ；不过snapshot版本支持，因此咱们刷这个版本；

1. 下载

    (下载地址)[https://downloads.openwrt.org/snapshots/targets/brcm2708/bcm2710/ ] 点击 rpi-3-ext4-factory.img.gz 下载

2. 格式化树莓派存储卡

3. 将img文件写到树莓派存储卡中

   

### 设置树莓派网络

1. 将树莓派连接电源，并将树莓派通过网线连接到电脑上
2. 通过ssh连接树莓派（树莓派默认的ip是192.168.1.1）

```shell
ssh root@192.168.1.1
```

3. 修改树莓派的网络设置

```shell
vi /etc/config/network
```

此处有两处修改，一是将 `config interface 'lan'`下的`option ifname 'eth0'`注释掉，二是添加一个wan的interface，具体如下：

```txt
config interface 'lan'
        option type 'bridge'
#       option ifname 'eth0'
        option proto 'static'
        option ipaddr '192.168.1.1'
        option netmask '255.255.255.0'
        option ip6assign '60'

config interface 'wan'
        option proto 'dhcp'
        option ifname 'eth0'
        option ipv6 'auto'
```

在将无线的配置修改掉

```shell
vi /etc/config/wireless
```

修改也是有两处，一是启用无线wifi将 radio0 的 disabled 改为0，二是设置无线密码，将default_radio0 的encryption修改为psk2，添加key密码

```
config wifi-device 'radio0'
        option type 'mac80211'
        option channel '36'
        option hwmode '11a'
        option path 'platform/soc/3f300000.mmc/mmc_host/mmc1/mmc1:0001/mmc1:0001:1'
        option htmode 'VHT80'
        option disabled '0'

config wifi-iface 'default_radio0'
        option device 'radio0'
        option network 'lan'
        option mode 'ap'
        option ssid 'OpenWrt'
        option encryption 'psk2'
        option key 'password'
```



### 安装luci

1. 将树莓派连接到可以上网的路由上
2. 电脑连接到树莓派的wifi（wifi名称是：ssid对应的OpenWrt）然后通过network配置的ipaddr（192.168.1.1）来访问
3. 代理设置（opkg 网络连接不稳，最好设置一下代理）

```shell
export http_proxy=http://192.168.50.43:8081
export https_proxy=http://192.168.50.43:8081
```
4. opkg 安装

```shell
opkg update
opkg install luci
opkg install luci-i18n-base-zh-cn
```

<!--

### 安装v2ray

```shell
opkg install bash
opkg install curl
opkg install unzip

curl -L -s https://install.direct/go.sh
bash go.sh
```

-->

---

参考：

[https://medium.com/@493462386/树莓派3b-安装openwrt-dc7fdf777619](https://medium.com/@493462386/树莓派3b-安装openwrt-dc7fdf777619)
[https://blog.csdn.net/dieju8330/article/details/86631238](https://blog.csdn.net/dieju8330/article/details/86631238)

